{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/arthur/Documents/Projects/sd-services/src/lib/image-url.ts"],"sourcesContent":["/**\n * Use the same-origin image proxy only for R2 URLs to avoid CORS.\n * Same-origin, relative, and other URLs (e.g. Google avatars) are returned unchanged.\n * Invalid URLs are returned as-is so the browser can fail gracefully instead of throwing.\n */\nconst R2_PUBLIC_RE = /^https:\\/\\/[a-zA-Z0-9.-]+\\.r2\\.dev(\\/|$)/;\n\nfunction isConstructableUrl(url: string): boolean {\n  if (url.startsWith(\"/\")) return true;\n  try {\n    new URL(url);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport function proxyImageUrlIfNeeded(url: string): string {\n  if (!url || url.startsWith(\"/\")) return url;\n  if (!isConstructableUrl(url)) return url;\n  if (R2_PUBLIC_RE.test(url)) {\n    return `/api/image?url=${encodeURIComponent(url)}`;\n  }\n  return url;\n}\n"],"names":[],"mappings":";;;;AAAA;;;;CAIC,GACD,MAAM,eAAe;AAErB,SAAS,mBAAmB,GAAW;IACrC,IAAI,IAAI,UAAU,CAAC,MAAM,OAAO;IAChC,IAAI;QACF,IAAI,IAAI;QACR,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,sBAAsB,GAAW;IAC/C,IAAI,CAAC,OAAO,IAAI,UAAU,CAAC,MAAM,OAAO;IACxC,IAAI,CAAC,mBAAmB,MAAM,OAAO;IACrC,IAAI,aAAa,IAAI,CAAC,MAAM;QAC1B,OAAO,CAAC,eAAe,EAAE,mBAAmB,MAAM;IACpD;IACA,OAAO;AACT"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/arthur/Documents/Projects/sd-services/src/components/image-uploader.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useRef, useState } from \"react\";\nimport { toast } from \"sonner\";\n\nimport { proxyImageUrlIfNeeded } from \"@/lib/image-url\";\nimport { cn } from \"@/lib/utils\";\n\nexport type UploadedImage = { url: string; previewUrl: string };\n\ninterface ImageUploaderProps {\n  /** Current list of already-uploaded image URLs */\n  value: string[];\n  onChange: (urls: string[]) => void;\n  /** Allow multiple images (default true) */\n  multiple?: boolean;\n  className?: string;\n  disabled?: boolean;\n}\n\nasync function uploadFiles(files: File[]): Promise<string[]> {\n  const formData = new FormData();\n  for (const file of files) {\n    formData.append(\"files\", file);\n  }\n  const res = await fetch(\n    typeof window !== \"undefined\"\n      ? `${window.location.origin}/api/upload`\n      : \"/api/upload\",\n    { method: \"POST\", body: formData, credentials: \"include\" },\n  );\n  if (!res.ok) {\n    const err = await res.json().catch(() => ({}));\n    throw new Error(err.error ?? \"Upload failed\");\n  }\n  const data = (await res.json()) as { urls?: string[]; url?: string };\n  return data.urls ?? (data.url ? [data.url] : []);\n}\n\nexport function ImageUploader({\n  value,\n  onChange,\n  multiple = true,\n  className,\n  disabled = false,\n}: ImageUploaderProps) {\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [dragging, setDragging] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [uploadingCount, setUploadingCount] = useState(0);\n\n  const handleFiles = useCallback(\n    async (files: FileList | File[]) => {\n      const list = Array.from(files).filter((f) => f.type.startsWith(\"image/\"));\n      if (list.length === 0) return;\n      if (!multiple && list.length > 1) {\n        toast.error(\"Only one image allowed here.\");\n        return;\n      }\n      setUploading(true);\n      setUploadingCount(list.length);\n      try {\n        const urls = await uploadFiles(list);\n        onChange(multiple ? [...value, ...urls] : urls);\n      } catch (e) {\n        toast.error(e instanceof Error ? e.message : \"Upload failed\");\n      } finally {\n        setUploading(false);\n        setUploadingCount(0);\n        if (inputRef.current) inputRef.current.value = \"\";\n      }\n    },\n    [multiple, onChange, value],\n  );\n\n  const handleDrop = useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault();\n      setDragging(false);\n      if (disabled || uploading) return;\n      handleFiles(e.dataTransfer.files);\n    },\n    [disabled, handleFiles, uploading],\n  );\n\n  const handleRemove = (url: string) => {\n    onChange(value.filter((u) => u !== url));\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) handleFiles(e.target.files);\n  };\n\n  const showDropZone = multiple || value.length === 0;\n\n  return (\n    <div className={cn(\"space-y-3\", className)}>\n      {/* Thumbnails */}\n      {value.length > 0 && (\n        <div className=\"grid grid-cols-3 gap-2 sm:grid-cols-4 lg:grid-cols-5\">\n          {value.map((url) => (\n            <div\n              key={url}\n              className=\"group relative aspect-square overflow-hidden border border-[var(--p-tan)] bg-[var(--p-warm-white)]\"\n            >\n              {/* eslint-disable-next-line @next/next/no-img-element */}\n              <img\n                src={proxyImageUrlIfNeeded(url)}\n                alt=\"\"\n                className=\"size-full object-cover\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => handleRemove(url)}\n                disabled={disabled || uploading}\n                aria-label=\"Remove image\"\n                className=\"absolute right-1 top-1 flex size-5 items-center justify-center bg-black/70 text-white opacity-0 outline-none transition-opacity group-hover:opacity-100 focus-visible:opacity-100 focus-visible:ring-1 focus-visible:ring-white\"\n              >\n                <svg width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" fill=\"none\" aria-hidden>\n                  <path d=\"M1 1l8 8M9 1L1 9\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\"/>\n                </svg>\n              </button>\n            </div>\n          ))}\n\n          {/* In-progress placeholders */}\n          {uploading &&\n            Array.from({ length: uploadingCount }).map((_, i) => (\n              <div\n                key={`uploading-${i}`}\n                className=\"aspect-square border border-[var(--p-tan)] bg-[var(--p-warm-white)]\"\n                aria-hidden\n              >\n                <div className=\"size-full animate-pulse bg-[var(--p-tan)]/30\" />\n              </div>\n            ))}\n        </div>\n      )}\n\n      {/* Drop zone */}\n      {showDropZone && (\n        <div\n          role=\"button\"\n          tabIndex={disabled ? -1 : 0}\n          aria-label=\"Upload images — click or drag and drop\"\n          aria-disabled={disabled || uploading}\n          onDragOver={(e) => { e.preventDefault(); setDragging(true); }}\n          onDragLeave={() => setDragging(false)}\n          onDrop={handleDrop}\n          onClick={() => !disabled && !uploading && inputRef.current?.click()}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\" || e.key === \" \") {\n              e.preventDefault();\n              if (!disabled && !uploading) inputRef.current?.click();\n            }\n          }}\n          className={cn(\n            \"flex cursor-pointer flex-col items-center justify-center gap-2 border-2 border-dashed py-10 text-center outline-none transition-colors\",\n            dragging\n              ? \"border-[var(--p-toffee)] bg-[var(--p-tan)]/10\"\n              : \"border-[var(--p-tan)] bg-[var(--p-white)] hover:border-[var(--p-toffee)] hover:bg-[var(--p-tan)]/5\",\n            (disabled || uploading) && \"cursor-not-allowed opacity-50\",\n          )}\n        >\n          <svg\n            width=\"28\"\n            height=\"28\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth=\"1.5\"\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            className=\"text-[var(--p-toffee)]\"\n            aria-hidden\n          >\n            <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" />\n            <polyline points=\"17 8 12 3 7 8\" />\n            <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\" />\n          </svg>\n          <div>\n            <p className=\"text-xs font-semibold text-[var(--p-deep-walnut)]\">\n              {uploading\n                ? `Uploading ${uploadingCount} file${uploadingCount > 1 ? \"s\" : \"\"}…`\n                : \"Click to upload or drag & drop\"}\n            </p>\n            <p className=\"mt-0.5 text-[11px] text-[var(--p-coffee-bean)]/60\">\n              {multiple ? \"PNG, JPG, WEBP — multiple allowed\" : \"PNG, JPG, WEBP\"}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* When not multiple and already has image, show replace button */}\n      {!multiple && value.length > 0 && (\n        <button\n          type=\"button\"\n          disabled={disabled || uploading}\n          onClick={() => inputRef.current?.click()}\n          className=\"inline-flex h-8 items-center gap-1.5 border border-[var(--p-tan)] bg-transparent px-3 text-xs font-medium text-[var(--p-coffee-bean)] outline-none transition-opacity hover:opacity-80 focus-visible:ring-1 focus-visible:ring-[var(--p-toffee)] disabled:opacity-50\"\n        >\n          {uploading ? \"Uploading…\" : \"Replace image\"}\n        </button>\n      )}\n\n      <input\n        ref={inputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        multiple={multiple}\n        className=\"hidden\"\n        aria-hidden\n        onChange={handleChange}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 323, "column": 0}, "map": {"version":3,"sources":["file:///Users/arthur/Documents/Projects/sd-services/src/app/cms/projects/project-form.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useRef, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { toast } from \"sonner\";\n\nimport { client } from \"@/utils/orpc\";\nimport { ImageUploader } from \"@/components/image-uploader\";\nimport { cn } from \"@/lib/utils\";\n\ntype ProjectFormValues = {\n  slug: string;\n  title: string;\n  description: string;\n  featuredImageUrl: string;\n  published: boolean;\n  imageUrls: string[];\n};\n\ntype FormErrors = Partial<Record<keyof ProjectFormValues, string>>;\n\nconst defaultValues: ProjectFormValues = {\n  slug: \"\",\n  title: \"\",\n  description: \"\",\n  featuredImageUrl: \"\",\n  published: false,\n  imageUrls: [],\n};\n\nconst SLUG_RE = /^[a-z0-9]+(?:-[a-z0-9]+)*$/;\n\nfunction toSlug(text: string): string {\n  return text\n    .toLowerCase()\n    .normalize(\"NFD\")\n    .replace(/[\\u0300-\\u036f]/g, \"\")\n    .replace(/[^a-z0-9\\s-]/g, \"\")\n    .trim()\n    .replace(/[\\s-]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n}\n\nfunction validateField(\n  name: keyof ProjectFormValues,\n  value: ProjectFormValues[keyof ProjectFormValues],\n  existingSlugs: string[] = [],\n): string | undefined {\n  if (name === \"slug\") {\n    const v = value as string;\n    if (!v.trim()) return \"Slug is required\";\n    if (!SLUG_RE.test(v))\n      return \"Slug must be lowercase letters, numbers, and hyphens only\";\n    if (existingSlugs.includes(v.trim().toLowerCase()))\n      return \"This slug is already used by another project.\";\n  }\n  if (name === \"title\") {\n    const v = value as string;\n    if (!v.trim()) return \"Title is required\";\n  }\n  return undefined;\n}\n\nfunction validateAll(\n  values: ProjectFormValues,\n  existingSlugs: string[] = [],\n): FormErrors {\n  const errors: FormErrors = {};\n  const fields: (keyof ProjectFormValues)[] = [\"slug\", \"title\"];\n  for (const f of fields) {\n    const err = validateField(f, values[f], existingSlugs);\n    if (err) errors[f] = err;\n  }\n  return errors;\n}\n\nconst labelClass =\n  \"block text-xs font-semibold uppercase tracking-wider text-[var(--p-deep-walnut)]\";\n\nfunction inputClass(hasError?: boolean) {\n  return cn(\n    \"flex h-9 w-full border bg-[var(--p-white)] px-3 text-sm text-[var(--p-dark-walnut)] outline-none placeholder:text-[var(--p-coffee-bean)]/40 focus-visible:ring-1\",\n    hasError\n      ? \"border-red-500 focus-visible:ring-red-400\"\n      : \"border-[var(--p-tan)] focus-visible:ring-[var(--p-toffee)]\",\n  );\n}\n\nconst btnPrimary =\n  \"inline-flex h-9 items-center justify-center border-2 border-[var(--p-deep-walnut)] bg-[var(--p-deep-walnut)] px-5 text-xs font-semibold text-[var(--p-white)] outline-none transition-opacity hover:opacity-90 focus-visible:ring-2 focus-visible:ring-[var(--p-deep-walnut)] focus-visible:ring-offset-2 disabled:opacity-50\";\nconst btnOutline =\n  \"inline-flex h-9 items-center justify-center border-2 border-[var(--p-tan)] bg-transparent px-5 text-xs font-semibold text-[var(--p-coffee-bean)] outline-none transition-opacity hover:opacity-80 focus-visible:ring-2 focus-visible:ring-[var(--p-toffee)] focus-visible:ring-offset-2\";\n\nfunction FieldError({ message }: { message?: string }) {\n  if (!message) return null;\n  return (\n    <p role=\"alert\" className=\"mt-1 text-xs font-medium text-red-600\">\n      {message}\n    </p>\n  );\n}\n\nexport function ProjectForm({\n  mode,\n  id,\n  initialData,\n}: {\n  mode: \"create\" | \"edit\";\n  id?: string;\n  initialData?: ProjectFormValues | null;\n}) {\n  const router = useRouter();\n  const [values, setValues] = useState<ProjectFormValues>(\n    initialData ?? defaultValues,\n  );\n  const [errors, setErrors] = useState<FormErrors>({});\n  const slugManuallyEdited = useRef(!!initialData?.slug);\n  const firstErrorRef = useRef<HTMLInputElement | HTMLTextAreaElement | null>(null);\n\n  const createMutation = useMutation({\n    mutationFn: (input: Parameters<typeof client.project.create>[0]) =>\n      client.project.create(input),\n    onSuccess: () => {\n      toast.success(\"Project created\");\n      router.push(\"/cms/projects\");\n    },\n    onError: (e: Error) => toast.error(e.message ?? \"Failed to create\"),\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: (input: Parameters<typeof client.project.update>[0]) =>\n      client.project.update(input),\n    onSuccess: () => {\n      toast.success(\"Project updated\");\n      router.push(\"/cms/projects\");\n    },\n    onError: (e: Error) => toast.error(e.message ?? \"Failed to update\"),\n  });\n\n  const isPending = createMutation.isPending || updateMutation.isPending;\n\n  const handleBlur = useCallback(\n    (name: keyof ProjectFormValues) => {\n      const err = validateField(name, values[name]);\n      setErrors((prev) => ({ ...prev, [name]: err }));\n    },\n    [values],\n  );\n\n  function handleTitleChange(e: React.ChangeEvent<HTMLInputElement>) {\n    const title = e.target.value;\n    setValues((v) => ({\n      ...v,\n      title,\n      slug: slugManuallyEdited.current ? v.slug : toSlug(title),\n    }));\n    if (errors.title) setErrors((prev) => ({ ...prev, title: undefined }));\n    if (!slugManuallyEdited.current && errors.slug) {\n      setErrors((prev) => ({ ...prev, slug: undefined }));\n    }\n  }\n\n  function handleSlugChange(e: React.ChangeEvent<HTMLInputElement>) {\n    const raw = e.target.value;\n    const normalised = toSlug(raw) || raw.replace(/[^a-z0-9-]/gi, \"\").toLowerCase();\n    slugManuallyEdited.current = true;\n    setValues((v) => ({ ...v, slug: normalised }));\n    if (errors.slug) setErrors((prev) => ({ ...prev, slug: undefined }));\n  }\n\n  function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    const errs = validateAll(values);\n    setErrors(errs);\n\n    if (Object.keys(errs).length > 0) {\n      // Focus first invalid field\n      requestAnimationFrame(() => {\n        firstErrorRef.current?.focus();\n      });\n      return;\n    }\n\n    const payload = {\n      slug: values.slug,\n      title: values.title.trim(),\n      description: values.description,\n      featuredImageUrl: values.featuredImageUrl.trim() || null,\n      published: values.published,\n      imageUrls: values.imageUrls.filter(Boolean),\n    };\n    if (mode === \"create\") {\n      createMutation.mutate(payload);\n    } else if (id) {\n      updateMutation.mutate({ id, ...payload });\n    }\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"max-w-2xl space-y-6\" noValidate>\n      {/* Details */}\n      <fieldset className=\"space-y-4 border border-[var(--p-tan)] bg-[var(--p-white)] p-6\">\n        <legend className=\"px-2 text-xs font-semibold uppercase tracking-wider text-[var(--p-toffee)]\">\n          Details\n        </legend>\n\n        {/* Title — first so auto-slug works */}\n        <div className=\"space-y-1.5\">\n          <label htmlFor=\"title\" className={labelClass}>\n            Title <span className=\"text-red-500\">*</span>\n          </label>\n          <input\n            id=\"title\"\n            ref={(el) => {\n              if (errors.title && !errors.slug) firstErrorRef.current = el;\n            }}\n            className={inputClass(!!errors.title)}\n            value={values.title}\n            onChange={handleTitleChange}\n            onBlur={() => handleBlur(\"title\")}\n            placeholder=\"Sharon Lane Kitchen\"\n          />\n          <FieldError message={errors.title} />\n        </div>\n\n        {/* Slug */}\n        <div className=\"space-y-1.5\">\n          <label htmlFor=\"slug\" className={labelClass}>\n            Slug <span className=\"text-red-500\">*</span>\n          </label>\n          <input\n            id=\"slug\"\n            ref={(el) => {\n              if (errors.slug) firstErrorRef.current = el;\n            }}\n            className={inputClass(!!errors.slug)}\n            value={values.slug}\n            onChange={handleSlugChange}\n            onBlur={() => handleBlur(\"slug\")}\n            placeholder=\"sharon-lane-kitchen\"\n          />\n          <p className=\"text-xs text-pretty text-[var(--p-coffee-bean)]/60\">\n            Auto-generated from title. Lowercase, numbers, hyphens only — used in{\" \"}\n            <code className=\"font-mono\">/projects/[slug]</code>.\n          </p>\n          <FieldError message={errors.slug} />\n        </div>\n\n        <div className=\"space-y-1.5\">\n          <label htmlFor=\"description\" className={labelClass}>\n            Description (Markdown)\n          </label>\n          <textarea\n            id=\"description\"\n            className=\"flex min-h-40 w-full border border-[var(--p-tan)] bg-[var(--p-white)] px-3 py-2 text-sm text-[var(--p-dark-walnut)] outline-none placeholder:text-[var(--p-coffee-bean)]/40 focus-visible:ring-1 focus-visible:ring-[var(--p-toffee)]\"\n            value={values.description}\n            onChange={(e) =>\n              setValues((v) => ({ ...v, description: e.target.value }))\n            }\n          />\n        </div>\n      </fieldset>\n\n      {/* Featured image */}\n      <fieldset className=\"space-y-4 border border-[var(--p-tan)] bg-[var(--p-white)] p-6\">\n        <legend className=\"px-2 text-xs font-semibold uppercase tracking-wider text-[var(--p-toffee)]\">\n          Featured image\n        </legend>\n        <p className=\"text-xs text-[var(--p-coffee-bean)]/60\">\n          The main image shown on the project card and hero. Upload one or paste a URL.\n        </p>\n        <ImageUploader\n          multiple={false}\n          value={values.featuredImageUrl ? [values.featuredImageUrl] : []}\n          onChange={(urls) => {\n            setValues((v) => ({ ...v, featuredImageUrl: urls[0] ?? \"\" }));\n            setErrors((prev) => ({ ...prev, featuredImageUrl: undefined }));\n          }}\n          disabled={isPending}\n        />\n        <div className=\"space-y-1\">\n          <label htmlFor=\"featured-url\" className={labelClass}>\n            Or paste URL\n          </label>\n          <input\n            id=\"featured-url\"\n            ref={(el) => {\n              if (errors.featuredImageUrl && !errors.slug && !errors.title)\n                firstErrorRef.current = el;\n            }}\n            className={inputClass(!!errors.featuredImageUrl)}\n            value={values.featuredImageUrl}\n            onChange={(e) => {\n              setValues((v) => ({ ...v, featuredImageUrl: e.target.value }));\n              if (errors.featuredImageUrl)\n                setErrors((prev) => ({ ...prev, featuredImageUrl: undefined }));\n            }}\n            onBlur={() => handleBlur(\"featuredImageUrl\")}\n            placeholder=\"https://...\"\n          />\n          <FieldError message={errors.featuredImageUrl} />\n        </div>\n      </fieldset>\n\n      {/* Gallery */}\n      <fieldset className=\"space-y-4 border border-[var(--p-tan)] bg-[var(--p-white)] p-6\">\n        <legend className=\"px-2 text-xs font-semibold uppercase tracking-wider text-[var(--p-toffee)]\">\n          Gallery images\n        </legend>\n        <p className=\"text-xs text-[var(--p-coffee-bean)]/60\">\n          Shown in the carousel on the project page. Select multiple files at once or drag &amp; drop.\n        </p>\n        {errors.imageUrls ? (\n          <p role=\"alert\" className=\"text-xs font-medium text-red-600\">\n            {errors.imageUrls}\n          </p>\n        ) : null}\n        <ImageUploader\n          multiple\n          value={values.imageUrls}\n          onChange={(urls) => setValues((v) => ({ ...v, imageUrls: urls }))}\n          disabled={isPending}\n        />\n      </fieldset>\n\n      {/* Publishing */}\n      <fieldset className=\"space-y-4 border border-[var(--p-tan)] bg-[var(--p-white)] p-6\">\n        <legend className=\"px-2 text-xs font-semibold uppercase tracking-wider text-[var(--p-toffee)]\">\n          Publishing\n        </legend>\n        <label className=\"flex cursor-pointer items-center gap-3\">\n          <input\n            type=\"checkbox\"\n            checked={values.published}\n            onChange={(e) =>\n              setValues((v) => ({ ...v, published: e.target.checked }))\n            }\n            className=\"size-4 accent-[var(--p-deep-walnut)]\"\n          />\n          <span className=\"text-sm text-[var(--p-dark-walnut)]\">\n            Published — visible on the public site\n          </span>\n        </label>\n      </fieldset>\n\n      {/* Submit */}\n      <div className=\"flex gap-3\">\n        <button type=\"submit\" className={btnPrimary} disabled={isPending}>\n          {mode === \"create\" ? \"Create project\" : \"Save changes\"}\n        </button>\n        <button\n          type=\"button\"\n          className={btnOutline}\n          onClick={() => router.push(\"/cms/projects\")}\n        >\n          Cancel\n        </button>\n      </div>\n    </form>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 892, "column": 0}, "map": {"version":3,"sources":["file:///Users/arthur/Documents/Projects/sd-services/node_modules/%40tanstack/query-core/src/mutationObserver.ts"],"sourcesContent":["import { getDefaultState } from './mutation'\nimport { notifyManager } from './notifyManager'\nimport { Subscribable } from './subscribable'\nimport { hashKey, shallowEqualObjects } from './utils'\nimport type { QueryClient } from './queryClient'\nimport type {\n  DefaultError,\n  MutateOptions,\n  MutationFunctionContext,\n  MutationObserverOptions,\n  MutationObserverResult,\n} from './types'\nimport type { Action, Mutation } from './mutation'\n\n// TYPES\n\ntype MutationObserverListener<TData, TError, TVariables, TOnMutateResult> = (\n  result: MutationObserverResult<TData, TError, TVariables, TOnMutateResult>,\n) => void\n\n// CLASS\n\nexport class MutationObserver<\n  TData = unknown,\n  TError = DefaultError,\n  TVariables = void,\n  TOnMutateResult = unknown,\n> extends Subscribable<\n  MutationObserverListener<TData, TError, TVariables, TOnMutateResult>\n> {\n  options!: MutationObserverOptions<TData, TError, TVariables, TOnMutateResult>\n\n  #client: QueryClient\n  #currentResult: MutationObserverResult<\n    TData,\n    TError,\n    TVariables,\n    TOnMutateResult\n  > = undefined!\n  #currentMutation?: Mutation<TData, TError, TVariables, TOnMutateResult>\n  #mutateOptions?: MutateOptions<TData, TError, TVariables, TOnMutateResult>\n\n  constructor(\n    client: QueryClient,\n    options: MutationObserverOptions<\n      TData,\n      TError,\n      TVariables,\n      TOnMutateResult\n    >,\n  ) {\n    super()\n\n    this.#client = client\n    this.setOptions(options)\n    this.bindMethods()\n    this.#updateResult()\n  }\n\n  protected bindMethods(): void {\n    this.mutate = this.mutate.bind(this)\n    this.reset = this.reset.bind(this)\n  }\n\n  setOptions(\n    options: MutationObserverOptions<\n      TData,\n      TError,\n      TVariables,\n      TOnMutateResult\n    >,\n  ) {\n    const prevOptions = this.options as\n      | MutationObserverOptions<TData, TError, TVariables, TOnMutateResult>\n      | undefined\n    this.options = this.#client.defaultMutationOptions(options)\n    if (!shallowEqualObjects(this.options, prevOptions)) {\n      this.#client.getMutationCache().notify({\n        type: 'observerOptionsUpdated',\n        mutation: this.#currentMutation,\n        observer: this,\n      })\n    }\n\n    if (\n      prevOptions?.mutationKey &&\n      this.options.mutationKey &&\n      hashKey(prevOptions.mutationKey) !== hashKey(this.options.mutationKey)\n    ) {\n      this.reset()\n    } else if (this.#currentMutation?.state.status === 'pending') {\n      this.#currentMutation.setOptions(this.options)\n    }\n  }\n\n  protected onUnsubscribe(): void {\n    if (!this.hasListeners()) {\n      this.#currentMutation?.removeObserver(this)\n    }\n  }\n\n  onMutationUpdate(\n    action: Action<TData, TError, TVariables, TOnMutateResult>,\n  ): void {\n    this.#updateResult()\n\n    this.#notify(action)\n  }\n\n  getCurrentResult(): MutationObserverResult<\n    TData,\n    TError,\n    TVariables,\n    TOnMutateResult\n  > {\n    return this.#currentResult\n  }\n\n  reset(): void {\n    // reset needs to remove the observer from the mutation because there is no way to \"get it back\"\n    // another mutate call will yield a new mutation!\n    this.#currentMutation?.removeObserver(this)\n    this.#currentMutation = undefined\n    this.#updateResult()\n    this.#notify()\n  }\n\n  mutate(\n    variables: TVariables,\n    options?: MutateOptions<TData, TError, TVariables, TOnMutateResult>,\n  ): Promise<TData> {\n    this.#mutateOptions = options\n\n    this.#currentMutation?.removeObserver(this)\n\n    this.#currentMutation = this.#client\n      .getMutationCache()\n      .build(this.#client, this.options)\n\n    this.#currentMutation.addObserver(this)\n\n    return this.#currentMutation.execute(variables)\n  }\n\n  #updateResult(): void {\n    const state =\n      this.#currentMutation?.state ??\n      getDefaultState<TData, TError, TVariables, TOnMutateResult>()\n\n    this.#currentResult = {\n      ...state,\n      isPending: state.status === 'pending',\n      isSuccess: state.status === 'success',\n      isError: state.status === 'error',\n      isIdle: state.status === 'idle',\n      mutate: this.mutate,\n      reset: this.reset,\n    } as MutationObserverResult<TData, TError, TVariables, TOnMutateResult>\n  }\n\n  #notify(action?: Action<TData, TError, TVariables, TOnMutateResult>): void {\n    notifyManager.batch(() => {\n      // First trigger the mutate callbacks\n      if (this.#mutateOptions && this.hasListeners()) {\n        const variables = this.#currentResult.variables!\n        const onMutateResult = this.#currentResult.context\n\n        const context = {\n          client: this.#client,\n          meta: this.options.meta,\n          mutationKey: this.options.mutationKey,\n        } satisfies MutationFunctionContext\n\n        if (action?.type === 'success') {\n          try {\n            this.#mutateOptions.onSuccess?.(\n              action.data,\n              variables,\n              onMutateResult,\n              context,\n            )\n          } catch (e) {\n            void Promise.reject(e)\n          }\n          try {\n            this.#mutateOptions.onSettled?.(\n              action.data,\n              null,\n              variables,\n              onMutateResult,\n              context,\n            )\n          } catch (e) {\n            void Promise.reject(e)\n          }\n        } else if (action?.type === 'error') {\n          try {\n            this.#mutateOptions.onError?.(\n              action.error,\n              variables,\n              onMutateResult,\n              context,\n            )\n          } catch (e) {\n            void Promise.reject(e)\n          }\n          try {\n            this.#mutateOptions.onSettled?.(\n              undefined,\n              action.error,\n              variables,\n              onMutateResult,\n              context,\n            )\n          } catch (e) {\n            void Promise.reject(e)\n          }\n        }\n      }\n\n      // Then trigger the listeners\n      this.listeners.forEach((listener) => {\n        listener(this.#currentResult)\n      })\n    })\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1020, "column": 0}, "map": {"version":3,"sources":["file:///Users/arthur/Documents/Projects/sd-services/node_modules/%40tanstack/react-query/src/useMutation.ts"],"sourcesContent":["'use client'\nimport * as React from 'react'\nimport {\n  MutationObserver,\n  noop,\n  notifyManager,\n  shouldThrowError,\n} from '@tanstack/query-core'\nimport { useQueryClient } from './QueryClientProvider'\nimport type {\n  UseMutateFunction,\n  UseMutationOptions,\n  UseMutationResult,\n} from './types'\nimport type { DefaultError, QueryClient } from '@tanstack/query-core'\n\n// HOOK\n\nexport function useMutation<\n  TData = unknown,\n  TError = DefaultError,\n  TVariables = void,\n  TOnMutateResult = unknown,\n>(\n  options: UseMutationOptions<TData, TError, TVariables, TOnMutateResult>,\n  queryClient?: QueryClient,\n): UseMutationResult<TData, TError, TVariables, TOnMutateResult> {\n  const client = useQueryClient(queryClient)\n\n  const [observer] = React.useState(\n    () =>\n      new MutationObserver<TData, TError, TVariables, TOnMutateResult>(\n        client,\n        options,\n      ),\n  )\n\n  React.useEffect(() => {\n    observer.setOptions(options)\n  }, [observer, options])\n\n  const result = React.useSyncExternalStore(\n    React.useCallback(\n      (onStoreChange) =>\n        observer.subscribe(notifyManager.batchCalls(onStoreChange)),\n      [observer],\n    ),\n    () => observer.getCurrentResult(),\n    () => observer.getCurrentResult(),\n  )\n\n  const mutate = React.useCallback<\n    UseMutateFunction<TData, TError, TVariables, TOnMutateResult>\n  >(\n    (variables, mutateOptions) => {\n      observer.mutate(variables, mutateOptions).catch(noop)\n    },\n    [observer],\n  )\n\n  if (\n    result.error &&\n    shouldThrowError(observer.options.throwOnError, [result.error])\n  ) {\n    throw result.error\n  }\n\n  return { ...result, mutate, mutateAsync: result.mutate }\n}\n"],"names":[],"mappings":";;;;;AACA,YAAY,WAAW;;;AACvB;AAMA,SAAS,sBAAsB;;;;;AAUxB,SAAS,YAMd,OAAA,EACA,WAAA,EAC+D;IAC/D,MAAM,aAAS,wMAAA,EAAe,WAAW;IAEzC,MAAM,CAAC,QAAQ,CAAA,GAAU,iNAAA,CACvB,IACE,IAAI,sMAAA,CACF,QACA;IAIA,kNAAA,CAAU,MAAM;QACpB,SAAS,UAAA,CAAW,OAAO;IAC7B,GAAG;QAAC;QAAU,OAAO;KAAC;IAEtB,MAAM,SAAe,6NAAA,CACb,oNAAA,CACJ,CAAC,gBACC,SAAS,SAAA,CAAU,gMAAA,CAAc,UAAA,CAAW,aAAa,CAAC,GAC5D;QAAC,QAAQ;KAAA,GAEX,IAAM,SAAS,gBAAA,CAAiB,GAChC,IAAM,SAAS,gBAAA,CAAiB;IAGlC,MAAM,SAAe,oNAAA,CAGnB,CAAC,WAAW,kBAAkB;QAC5B,SAAS,MAAA,CAAO,WAAW,aAAa,EAAE,KAAA,CAAM,+KAAI;IACtD,GACA;QAAC,QAAQ;KAAA;IAGX,IACE,OAAO,KAAA,QACP,2LAAA,EAAiB,SAAS,OAAA,CAAQ,YAAA,EAAc;QAAC,OAAO,KAAK;KAAC,GAC9D;QACA,MAAM,OAAO,KAAA;IACf;IAEA,OAAO;QAAE,GAAG,MAAA;QAAQ;QAAQ,aAAa,OAAO,MAAA;IAAO;AACzD"}}]
}