{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/arthur/Documents/Projects/sd-services/src/components/ui/button.tsx"],"sourcesContent":["import type { VariantProps } from \"class-variance-authority\";\n\nimport { Button as ButtonPrimitive } from \"@base-ui/react/button\";\nimport { cva } from \"class-variance-authority\";\n\nimport { cn } from \"@/lib/utils\";\n\nconst buttonVariants = cva(\n  \"focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:aria-invalid:border-destructive/50 rounded-none border border-transparent bg-clip-padding text-xs font-medium focus-visible:ring-1 aria-invalid:ring-1 [&_svg:not([class*='size-'])]:size-4 inline-flex items-center justify-center whitespace-nowrap transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none shrink-0 [&_svg]:shrink-0 outline-none group/button select-none\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground [a]:hover:bg-primary/80\",\n        outline:\n          \"border-border bg-background hover:bg-muted hover:text-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 aria-expanded:bg-muted aria-expanded:text-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80 aria-expanded:bg-secondary aria-expanded:text-secondary-foreground\",\n        ghost:\n          \"hover:bg-muted hover:text-foreground dark:hover:bg-muted/50 aria-expanded:bg-muted aria-expanded:text-foreground\",\n        destructive:\n          \"bg-destructive/10 hover:bg-destructive/20 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/20 text-destructive focus-visible:border-destructive/40 dark:hover:bg-destructive/30\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default:\n          \"h-8 gap-1.5 px-2.5 has-data-[icon=inline-end]:pr-2 has-data-[icon=inline-start]:pl-2\",\n        xs: \"h-6 gap-1 rounded-none px-2 text-xs has-data-[icon=inline-end]:pr-1.5 has-data-[icon=inline-start]:pl-1.5 [&_svg:not([class*='size-'])]:size-3\",\n        sm: \"h-7 gap-1 rounded-none px-2.5 has-data-[icon=inline-end]:pr-1.5 has-data-[icon=inline-start]:pl-1.5 [&_svg:not([class*='size-'])]:size-3.5\",\n        lg: \"h-9 gap-1.5 px-2.5 has-data-[icon=inline-end]:pr-3 has-data-[icon=inline-start]:pl-3\",\n        icon: \"size-8\",\n        \"icon-xs\": \"size-6 rounded-none [&_svg:not([class*='size-'])]:size-3\",\n        \"icon-sm\": \"size-7 rounded-none\",\n        \"icon-lg\": \"size-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nfunction Button({\n  className,\n  variant = \"default\",\n  size = \"default\",\n  ...props\n}: ButtonPrimitive.Props & VariantProps<typeof buttonVariants>) {\n  return (\n    <ButtonPrimitive\n      data-slot=\"button\"\n      className={cn(buttonVariants({ variant, size, className }))}\n      {...props}\n    />\n  );\n}\n\nexport { Button, buttonVariants };\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAEA;;;;;AAEA,MAAM,iBAAiB,IAAA,uKAAG,EACxB,sjBACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,SACE;YACF,WACE;YACF,OACE;YACF,aACE;YACF,MAAM;QACR;QACA,MAAM;YACJ,SACE;YACF,IAAI;YACJ,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AAGF,SAAS,OAAO,EACd,SAAS,EACT,UAAU,SAAS,EACnB,OAAO,SAAS,EAChB,GAAG,OACyD;IAC5D,qBACE,8OAAC,0KAAe;QACd,aAAU;QACV,WAAW,IAAA,yHAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACvD,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/arthur/Documents/Projects/sd-services/src/components/ui/alert-dialog.tsx"],"sourcesContent":["\"use client\";\n\nimport { AlertDialog as AlertDialogPrimitive } from \"@base-ui/react/alert-dialog\";\n\nimport { cn } from \"@/lib/utils\";\n\nimport { buttonVariants } from \"./button\";\n\nfunction AlertDialogRoot(\n  props: React.ComponentProps<typeof AlertDialogPrimitive.Root>,\n) {\n  return <AlertDialogPrimitive.Root {...props} />;\n}\n\nfunction AlertDialogPortal({ ...props }: AlertDialogPrimitive.Portal.Props) {\n  return <AlertDialogPrimitive.Portal {...props} />;\n}\n\nfunction AlertDialogBackdrop({\n  className,\n  ...props\n}: AlertDialogPrimitive.Backdrop.Props) {\n  return (\n    <AlertDialogPrimitive.Backdrop\n      className={cn(\n        \"fixed inset-0 z-50 bg-black/50 data-[closed]:animate-out data-[closed]:fade-out-0 data-[starting-style]:animate-in data-[starting-style]:fade-in-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction AlertDialogViewport({\n  className,\n  ...props\n}: AlertDialogPrimitive.Viewport.Props) {\n  return (\n    <AlertDialogPrimitive.Viewport\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-border bg-background p-6 shadow-lg duration-200 data-[closed]:animate-out data-[closed]:fade-out-0 data-[closed]:zoom-out-95 data-[starting-style]:animate-in data-[starting-style]:fade-in-0 data-[starting-style]:zoom-in-95\",\n        className,\n      )}\n      {...props}\n    />\n  );\n}\n\nfunction AlertDialogPopup({\n  className,\n  ...props\n}: AlertDialogPrimitive.Popup.Props) {\n  return (\n    <AlertDialogPrimitive.Popup\n      className={cn(\"grid gap-4\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction AlertDialogTitle({\n  className,\n  ...props\n}: AlertDialogPrimitive.Title.Props) {\n  return (\n    <AlertDialogPrimitive.Title\n      className={cn(\"text-lg font-semibold text-balance\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction AlertDialogDescription({\n  className,\n  ...props\n}: AlertDialogPrimitive.Description.Props) {\n  return (\n    <AlertDialogPrimitive.Description\n      className={cn(\"text-sm text-muted-foreground text-pretty\", className)}\n      {...props}\n    />\n  );\n}\n\nfunction AlertDialogClose({\n  className,\n  variant = \"outline\",\n  ...props\n}: React.ComponentProps<typeof AlertDialogPrimitive.Close> & {\n  variant?: \"default\" | \"destructive\" | \"outline\";\n}) {\n  return (\n    <AlertDialogPrimitive.Close\n      className={cn(buttonVariants({ variant }), className)}\n      {...props}\n    />\n  );\n}\n\nexport {\n  AlertDialogBackdrop,\n  AlertDialogClose,\n  AlertDialogDescription,\n  AlertDialogPortal,\n  AlertDialogPopup,\n  AlertDialogRoot,\n  AlertDialogTitle,\n  AlertDialogViewport,\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAEA;AAEA;AAEA;AANA;;;;;AAQA,SAAS,gBACP,KAA6D;IAE7D,qBAAO,8OAAC,uOAAoB,CAAC,IAAI;QAAE,GAAG,KAAK;;;;;;AAC7C;AAEA,SAAS,kBAAkB,EAAE,GAAG,OAA0C;IACxE,qBAAO,8OAAC,uOAAoB,CAAC,MAAM;QAAE,GAAG,KAAK;;;;;;AAC/C;AAEA,SAAS,oBAAoB,EAC3B,SAAS,EACT,GAAG,OACiC;IACpC,qBACE,8OAAC,uOAAoB,CAAC,QAAQ;QAC5B,WAAW,IAAA,yHAAE,EACX,sJACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,oBAAoB,EAC3B,SAAS,EACT,GAAG,OACiC;IACpC,qBACE,8OAAC,uOAAoB,CAAC,QAAQ;QAC5B,WAAW,IAAA,yHAAE,EACX,iVACA;QAED,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,iBAAiB,EACxB,SAAS,EACT,GAAG,OAC8B;IACjC,qBACE,8OAAC,uOAAoB,CAAC,KAAK;QACzB,WAAW,IAAA,yHAAE,EAAC,cAAc;QAC3B,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,iBAAiB,EACxB,SAAS,EACT,GAAG,OAC8B;IACjC,qBACE,8OAAC,uOAAoB,CAAC,KAAK;QACzB,WAAW,IAAA,yHAAE,EAAC,sCAAsC;QACnD,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,uBAAuB,EAC9B,SAAS,EACT,GAAG,OACoC;IACvC,qBACE,8OAAC,uOAAoB,CAAC,WAAW;QAC/B,WAAW,IAAA,yHAAE,EAAC,6CAA6C;QAC1D,GAAG,KAAK;;;;;;AAGf;AAEA,SAAS,iBAAiB,EACxB,SAAS,EACT,UAAU,SAAS,EACnB,GAAG,OAGJ;IACC,qBACE,8OAAC,uOAAoB,CAAC,KAAK;QACzB,WAAW,IAAA,yHAAE,EAAC,IAAA,oJAAc,EAAC;YAAE;QAAQ,IAAI;QAC1C,GAAG,KAAK;;;;;;AAGf"}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///Users/arthur/Documents/Projects/sd-services/src/lib/image-url.ts"],"sourcesContent":["/**\n * Use the same-origin image proxy only for R2 URLs to avoid CORS.\n * Same-origin, relative, and other URLs (e.g. Google avatars) are returned unchanged.\n * Invalid URLs are returned as-is so the browser can fail gracefully instead of throwing.\n */\nconst R2_PUBLIC_RE = /^https:\\/\\/[a-zA-Z0-9.-]+\\.r2\\.dev(\\/|$)/;\n\nfunction isConstructableUrl(url: string): boolean {\n  if (url.startsWith(\"/\")) return true;\n  try {\n    new URL(url);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport function proxyImageUrlIfNeeded(url: string): string {\n  if (!url || url.startsWith(\"/\")) return url;\n  if (!isConstructableUrl(url)) return url;\n  if (R2_PUBLIC_RE.test(url)) {\n    return `/api/image?url=${encodeURIComponent(url)}`;\n  }\n  return url;\n}\n"],"names":[],"mappings":";;;;AAAA;;;;CAIC,GACD,MAAM,eAAe;AAErB,SAAS,mBAAmB,GAAW;IACrC,IAAI,IAAI,UAAU,CAAC,MAAM,OAAO;IAChC,IAAI;QACF,IAAI,IAAI;QACR,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,sBAAsB,GAAW;IAC/C,IAAI,CAAC,OAAO,IAAI,UAAU,CAAC,MAAM,OAAO;IACxC,IAAI,CAAC,mBAAmB,MAAM,OAAO;IACrC,IAAI,aAAa,IAAI,CAAC,MAAM;QAC1B,OAAO,CAAC,eAAe,EAAE,mBAAmB,MAAM;IACpD;IACA,OAAO;AACT"}},
    {"offset": {"line": 206, "column": 0}, "map": {"version":3,"sources":["file:///Users/arthur/Documents/Projects/sd-services/src/components/image-uploader.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useRef, useState } from \"react\";\nimport { toast } from \"sonner\";\n\nimport { proxyImageUrlIfNeeded } from \"@/lib/image-url\";\nimport { cn } from \"@/lib/utils\";\n\nexport type UploadedImage = { url: string; previewUrl: string };\n\ninterface ImageUploaderProps {\n  /** Current list of already-uploaded image URLs */\n  value: string[];\n  onChange: (urls: string[]) => void;\n  /** Allow multiple images (default true) */\n  multiple?: boolean;\n  className?: string;\n  disabled?: boolean;\n}\n\nasync function uploadFiles(files: File[]): Promise<string[]> {\n  const formData = new FormData();\n  for (const file of files) {\n    formData.append(\"files\", file);\n  }\n  const res = await fetch(\n    typeof window !== \"undefined\"\n      ? `${window.location.origin}/api/upload`\n      : \"/api/upload\",\n    { method: \"POST\", body: formData, credentials: \"include\" },\n  );\n  if (!res.ok) {\n    const err = await res.json().catch(() => ({}));\n    throw new Error(err.error ?? \"Upload failed\");\n  }\n  const data = (await res.json()) as { urls?: string[]; url?: string };\n  return data.urls ?? (data.url ? [data.url] : []);\n}\n\nexport function ImageUploader({\n  value,\n  onChange,\n  multiple = true,\n  className,\n  disabled = false,\n}: ImageUploaderProps) {\n  const inputRef = useRef<HTMLInputElement>(null);\n  const [dragging, setDragging] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [uploadingCount, setUploadingCount] = useState(0);\n\n  const handleFiles = useCallback(\n    async (files: FileList | File[]) => {\n      const list = Array.from(files).filter((f) => f.type.startsWith(\"image/\"));\n      if (list.length === 0) return;\n      if (!multiple && list.length > 1) {\n        toast.error(\"Only one image allowed here.\");\n        return;\n      }\n      setUploading(true);\n      setUploadingCount(list.length);\n      try {\n        const urls = await uploadFiles(list);\n        onChange(multiple ? [...value, ...urls] : urls);\n      } catch (e) {\n        toast.error(e instanceof Error ? e.message : \"Upload failed\");\n      } finally {\n        setUploading(false);\n        setUploadingCount(0);\n        if (inputRef.current) inputRef.current.value = \"\";\n      }\n    },\n    [multiple, onChange, value],\n  );\n\n  const handleDrop = useCallback(\n    (e: React.DragEvent) => {\n      e.preventDefault();\n      setDragging(false);\n      if (disabled || uploading) return;\n      handleFiles(e.dataTransfer.files);\n    },\n    [disabled, handleFiles, uploading],\n  );\n\n  const handleRemove = (url: string) => {\n    onChange(value.filter((u) => u !== url));\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) handleFiles(e.target.files);\n  };\n\n  const showDropZone = multiple || value.length === 0;\n\n  return (\n    <div className={cn(\"space-y-3\", className)}>\n      {/* Thumbnails */}\n      {value.length > 0 && (\n        <div className=\"grid grid-cols-3 gap-2 sm:grid-cols-4 lg:grid-cols-5\">\n          {value.map((url) => (\n            <div\n              key={url}\n              className=\"group relative aspect-square overflow-hidden border border-[var(--p-tan)] bg-[var(--p-warm-white)]\"\n            >\n              {/* eslint-disable-next-line @next/next/no-img-element */}\n              <img\n                src={proxyImageUrlIfNeeded(url)}\n                alt=\"\"\n                className=\"size-full object-cover\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => handleRemove(url)}\n                disabled={disabled || uploading}\n                aria-label=\"Remove image\"\n                className=\"absolute right-1 top-1 flex size-5 items-center justify-center bg-black/70 text-white opacity-0 outline-none transition-opacity group-hover:opacity-100 focus-visible:opacity-100 focus-visible:ring-1 focus-visible:ring-white\"\n              >\n                <svg width=\"10\" height=\"10\" viewBox=\"0 0 10 10\" fill=\"none\" aria-hidden>\n                  <path d=\"M1 1l8 8M9 1L1 9\" stroke=\"currentColor\" strokeWidth=\"1.5\" strokeLinecap=\"round\"/>\n                </svg>\n              </button>\n            </div>\n          ))}\n\n          {/* In-progress placeholders */}\n          {uploading &&\n            Array.from({ length: uploadingCount }).map((_, i) => (\n              <div\n                key={`uploading-${i}`}\n                className=\"aspect-square border border-[var(--p-tan)] bg-[var(--p-warm-white)]\"\n                aria-hidden\n              >\n                <div className=\"size-full animate-pulse bg-[var(--p-tan)]/30\" />\n              </div>\n            ))}\n        </div>\n      )}\n\n      {/* Drop zone */}\n      {showDropZone && (\n        <div\n          role=\"button\"\n          tabIndex={disabled ? -1 : 0}\n          aria-label=\"Upload images — click or drag and drop\"\n          aria-disabled={disabled || uploading}\n          onDragOver={(e) => { e.preventDefault(); setDragging(true); }}\n          onDragLeave={() => setDragging(false)}\n          onDrop={handleDrop}\n          onClick={() => !disabled && !uploading && inputRef.current?.click()}\n          onKeyDown={(e) => {\n            if (e.key === \"Enter\" || e.key === \" \") {\n              e.preventDefault();\n              if (!disabled && !uploading) inputRef.current?.click();\n            }\n          }}\n          className={cn(\n            \"flex cursor-pointer flex-col items-center justify-center gap-2 border-2 border-dashed py-10 text-center outline-none transition-colors\",\n            dragging\n              ? \"border-[var(--p-toffee)] bg-[var(--p-tan)]/10\"\n              : \"border-[var(--p-tan)] bg-[var(--p-white)] hover:border-[var(--p-toffee)] hover:bg-[var(--p-tan)]/5\",\n            (disabled || uploading) && \"cursor-not-allowed opacity-50\",\n          )}\n        >\n          <svg\n            width=\"28\"\n            height=\"28\"\n            viewBox=\"0 0 24 24\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            strokeWidth=\"1.5\"\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n            className=\"text-[var(--p-toffee)]\"\n            aria-hidden\n          >\n            <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\" />\n            <polyline points=\"17 8 12 3 7 8\" />\n            <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\" />\n          </svg>\n          <div>\n            <p className=\"text-xs font-semibold text-[var(--p-deep-walnut)]\">\n              {uploading\n                ? `Uploading ${uploadingCount} file${uploadingCount > 1 ? \"s\" : \"\"}…`\n                : \"Click to upload or drag & drop\"}\n            </p>\n            <p className=\"mt-0.5 text-[11px] text-[var(--p-coffee-bean)]/60\">\n              {multiple ? \"PNG, JPG, WEBP — multiple allowed\" : \"PNG, JPG, WEBP\"}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* When not multiple and already has image, show replace button */}\n      {!multiple && value.length > 0 && (\n        <button\n          type=\"button\"\n          disabled={disabled || uploading}\n          onClick={() => inputRef.current?.click()}\n          className=\"inline-flex h-8 items-center gap-1.5 border border-[var(--p-tan)] bg-transparent px-3 text-xs font-medium text-[var(--p-coffee-bean)] outline-none transition-opacity hover:opacity-80 focus-visible:ring-1 focus-visible:ring-[var(--p-toffee)] disabled:opacity-50\"\n        >\n          {uploading ? \"Uploading…\" : \"Replace image\"}\n        </button>\n      )}\n\n      <input\n        ref={inputRef}\n        type=\"file\"\n        accept=\"image/*\"\n        multiple={multiple}\n        className=\"hidden\"\n        aria-hidden\n        onChange={handleChange}\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 495, "column": 0}, "map": {"version":3,"sources":["file:///Users/arthur/Documents/Projects/sd-services/src/app/cms/projects/project-form.tsx"],"sourcesContent":["\"use client\";\n\nimport { useCallback, useRef, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { toast } from \"sonner\";\n\nimport { client } from \"@/utils/orpc\";\nimport { ImageUploader } from \"@/components/image-uploader\";\nimport { cn } from \"@/lib/utils\";\n\ntype ProjectFormValues = {\n  slug: string;\n  title: string;\n  description: string;\n  featuredImageUrl: string;\n  published: boolean;\n  imageUrls: string[];\n};\n\ntype FormErrors = Partial<Record<keyof ProjectFormValues, string>>;\n\nconst defaultValues: ProjectFormValues = {\n  slug: \"\",\n  title: \"\",\n  description: \"\",\n  featuredImageUrl: \"\",\n  published: false,\n  imageUrls: [],\n};\n\nconst SLUG_RE = /^[a-z0-9]+(?:-[a-z0-9]+)*$/;\n\nfunction toSlug(text: string): string {\n  return text\n    .toLowerCase()\n    .normalize(\"NFD\")\n    .replace(/[\\u0300-\\u036f]/g, \"\")\n    .replace(/[^a-z0-9\\s-]/g, \"\")\n    .trim()\n    .replace(/[\\s-]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\");\n}\n\nfunction validateField(\n  name: keyof ProjectFormValues,\n  value: ProjectFormValues[keyof ProjectFormValues],\n  existingSlugs: string[] = [],\n): string | undefined {\n  if (name === \"slug\") {\n    const v = value as string;\n    if (!v.trim()) return \"Slug is required\";\n    if (!SLUG_RE.test(v))\n      return \"Slug must be lowercase letters, numbers, and hyphens only\";\n    if (existingSlugs.includes(v.trim().toLowerCase()))\n      return \"This slug is already used by another project.\";\n  }\n  if (name === \"title\") {\n    const v = value as string;\n    if (!v.trim()) return \"Title is required\";\n  }\n  return undefined;\n}\n\nfunction validateAll(\n  values: ProjectFormValues,\n  existingSlugs: string[] = [],\n): FormErrors {\n  const errors: FormErrors = {};\n  const fields: (keyof ProjectFormValues)[] = [\"slug\", \"title\"];\n  for (const f of fields) {\n    const err = validateField(f, values[f], existingSlugs);\n    if (err) errors[f] = err;\n  }\n  return errors;\n}\n\nconst labelClass =\n  \"block text-xs font-semibold uppercase tracking-wider text-[var(--p-deep-walnut)]\";\n\nfunction inputClass(hasError?: boolean) {\n  return cn(\n    \"flex h-9 w-full border bg-[var(--p-white)] px-3 text-sm text-[var(--p-dark-walnut)] outline-none placeholder:text-[var(--p-coffee-bean)]/40 focus-visible:ring-1\",\n    hasError\n      ? \"border-red-500 focus-visible:ring-red-400\"\n      : \"border-[var(--p-tan)] focus-visible:ring-[var(--p-toffee)]\",\n  );\n}\n\nconst btnPrimary =\n  \"inline-flex h-9 items-center justify-center border-2 border-[var(--p-deep-walnut)] bg-[var(--p-deep-walnut)] px-5 text-xs font-semibold text-[var(--p-white)] outline-none transition-opacity hover:opacity-90 focus-visible:ring-2 focus-visible:ring-[var(--p-deep-walnut)] focus-visible:ring-offset-2 disabled:opacity-50\";\nconst btnOutline =\n  \"inline-flex h-9 items-center justify-center border-2 border-[var(--p-tan)] bg-transparent px-5 text-xs font-semibold text-[var(--p-coffee-bean)] outline-none transition-opacity hover:opacity-80 focus-visible:ring-2 focus-visible:ring-[var(--p-toffee)] focus-visible:ring-offset-2\";\n\nfunction FieldError({ message }: { message?: string }) {\n  if (!message) return null;\n  return (\n    <p role=\"alert\" className=\"mt-1 text-xs font-medium text-red-600\">\n      {message}\n    </p>\n  );\n}\n\nexport function ProjectForm({\n  mode,\n  id,\n  initialData,\n}: {\n  mode: \"create\" | \"edit\";\n  id?: string;\n  initialData?: ProjectFormValues | null;\n}) {\n  const router = useRouter();\n  const [values, setValues] = useState<ProjectFormValues>(\n    initialData ?? defaultValues,\n  );\n  const [errors, setErrors] = useState<FormErrors>({});\n  const slugManuallyEdited = useRef(!!initialData?.slug);\n  const firstErrorRef = useRef<HTMLInputElement | HTMLTextAreaElement | null>(null);\n\n  const { data: projects } = useQuery({\n    queryKey: [\"projects\", \"admin\"],\n    queryFn: () => client.project.listAdmin(),\n  });\n  const existingSlugs =\n    mode === \"create\"\n      ? (projects?.map((p) => p.slug) ?? [])\n      : (projects?.filter((p) => p.id !== id).map((p) => p.slug) ?? []);\n\n  const createMutation = useMutation({\n    mutationFn: (input: Parameters<typeof client.project.create>[0]) =>\n      client.project.create(input),\n    onSuccess: () => {\n      toast.success(\"Project created\");\n      router.push(\"/cms/projects\");\n    },\n    onError: (e: Error) => toast.error(e.message ?? \"Failed to create\"),\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: (input: Parameters<typeof client.project.update>[0]) =>\n      client.project.update(input),\n    onSuccess: () => {\n      toast.success(\"Project updated\");\n      router.push(\"/cms/projects\");\n    },\n    onError: (e: Error) => toast.error(e.message ?? \"Failed to update\"),\n  });\n\n  const isPending = createMutation.isPending || updateMutation.isPending;\n\n  const handleBlur = useCallback(\n    (name: keyof ProjectFormValues) => {\n      const err = validateField(name, values[name], existingSlugs);\n      setErrors((prev) => ({ ...prev, [name]: err }));\n    },\n    [values, existingSlugs],\n  );\n\n  function handleTitleChange(e: React.ChangeEvent<HTMLInputElement>) {\n    const title = e.target.value;\n    setValues((v) => ({\n      ...v,\n      title,\n      slug: slugManuallyEdited.current ? v.slug : toSlug(title),\n    }));\n    if (errors.title) setErrors((prev) => ({ ...prev, title: undefined }));\n    if (!slugManuallyEdited.current && errors.slug) {\n      setErrors((prev) => ({ ...prev, slug: undefined }));\n    }\n  }\n\n  function handleSlugChange(e: React.ChangeEvent<HTMLInputElement>) {\n    const raw = e.target.value;\n    const normalised = toSlug(raw) || raw.replace(/[^a-z0-9-]/gi, \"\").toLowerCase();\n    slugManuallyEdited.current = true;\n    setValues((v) => ({ ...v, slug: normalised }));\n    if (errors.slug) setErrors((prev) => ({ ...prev, slug: undefined }));\n  }\n\n  function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    const errs = validateAll(values, existingSlugs);\n    setErrors(errs);\n\n    if (Object.keys(errs).length > 0) {\n      // Focus first invalid field\n      requestAnimationFrame(() => {\n        firstErrorRef.current?.focus();\n      });\n      return;\n    }\n\n    const payload = {\n      slug: values.slug,\n      title: values.title.trim(),\n      description: values.description,\n      featuredImageUrl: values.featuredImageUrl.trim() || null,\n      published: values.published,\n      imageUrls: values.imageUrls.filter(Boolean),\n    };\n    if (mode === \"create\") {\n      createMutation.mutate(payload);\n    } else if (id) {\n      updateMutation.mutate({ id, ...payload });\n    }\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"max-w-2xl space-y-6\" noValidate>\n      {/* Details */}\n      <fieldset className=\"space-y-4 border border-[var(--p-tan)] bg-[var(--p-white)] p-6\">\n        <legend className=\"px-2 text-xs font-semibold uppercase tracking-wider text-[var(--p-toffee)]\">\n          Details\n        </legend>\n\n        {/* Title — first so auto-slug works */}\n        <div className=\"space-y-1.5\">\n          <label htmlFor=\"title\" className={labelClass}>\n            Title <span className=\"text-red-500\">*</span>\n          </label>\n          <input\n            id=\"title\"\n            ref={(el) => {\n              if (errors.title && !errors.slug) firstErrorRef.current = el;\n            }}\n            className={inputClass(!!errors.title)}\n            value={values.title}\n            onChange={handleTitleChange}\n            onBlur={() => handleBlur(\"title\")}\n            placeholder=\"Sharon Lane Kitchen\"\n          />\n          <FieldError message={errors.title} />\n        </div>\n\n        {/* Slug */}\n        <div className=\"space-y-1.5\">\n          <label htmlFor=\"slug\" className={labelClass}>\n            Slug <span className=\"text-red-500\">*</span>\n          </label>\n          <input\n            id=\"slug\"\n            ref={(el) => {\n              if (errors.slug) firstErrorRef.current = el;\n            }}\n            className={inputClass(!!errors.slug)}\n            value={values.slug}\n            onChange={handleSlugChange}\n            onBlur={() => handleBlur(\"slug\")}\n            placeholder=\"sharon-lane-kitchen\"\n          />\n          <p className=\"text-xs text-pretty text-[var(--p-coffee-bean)]/60\">\n            Auto-generated from title. Lowercase, numbers, hyphens only — used in{\" \"}\n            <code className=\"font-mono\">/projects/[slug]</code>.\n          </p>\n          <FieldError message={errors.slug} />\n        </div>\n\n        <div className=\"space-y-1.5\">\n          <label htmlFor=\"description\" className={labelClass}>\n            Description (Markdown)\n          </label>\n          <textarea\n            id=\"description\"\n            className=\"flex min-h-40 w-full border border-[var(--p-tan)] bg-[var(--p-white)] px-3 py-2 text-sm text-[var(--p-dark-walnut)] outline-none placeholder:text-[var(--p-coffee-bean)]/40 focus-visible:ring-1 focus-visible:ring-[var(--p-toffee)]\"\n            value={values.description}\n            onChange={(e) =>\n              setValues((v) => ({ ...v, description: e.target.value }))\n            }\n          />\n        </div>\n      </fieldset>\n\n      {/* Featured image */}\n      <fieldset className=\"space-y-4 border border-[var(--p-tan)] bg-[var(--p-white)] p-6\">\n        <legend className=\"px-2 text-xs font-semibold uppercase tracking-wider text-[var(--p-toffee)]\">\n          Featured image\n        </legend>\n        <p className=\"text-xs text-[var(--p-coffee-bean)]/60\">\n          The main image shown on the project card and hero. Upload one or paste a URL.\n        </p>\n        <ImageUploader\n          multiple={false}\n          value={values.featuredImageUrl ? [values.featuredImageUrl] : []}\n          onChange={(urls) => {\n            setValues((v) => ({ ...v, featuredImageUrl: urls[0] ?? \"\" }));\n            setErrors((prev) => ({ ...prev, featuredImageUrl: undefined }));\n          }}\n          disabled={isPending}\n        />\n        <div className=\"space-y-1\">\n          <label htmlFor=\"featured-url\" className={labelClass}>\n            Or paste URL\n          </label>\n          <input\n            id=\"featured-url\"\n            ref={(el) => {\n              if (errors.featuredImageUrl && !errors.slug && !errors.title)\n                firstErrorRef.current = el;\n            }}\n            className={inputClass(!!errors.featuredImageUrl)}\n            value={values.featuredImageUrl}\n            onChange={(e) => {\n              setValues((v) => ({ ...v, featuredImageUrl: e.target.value }));\n              if (errors.featuredImageUrl)\n                setErrors((prev) => ({ ...prev, featuredImageUrl: undefined }));\n            }}\n            onBlur={() => handleBlur(\"featuredImageUrl\")}\n            placeholder=\"https://...\"\n          />\n          <FieldError message={errors.featuredImageUrl} />\n        </div>\n      </fieldset>\n\n      {/* Gallery */}\n      <fieldset className=\"space-y-4 border border-[var(--p-tan)] bg-[var(--p-white)] p-6\">\n        <legend className=\"px-2 text-xs font-semibold uppercase tracking-wider text-[var(--p-toffee)]\">\n          Gallery images\n        </legend>\n        <p className=\"text-xs text-[var(--p-coffee-bean)]/60\">\n          Shown in the carousel on the project page. Select multiple files at once or drag &amp; drop.\n        </p>\n        <ImageUploader\n          multiple\n          value={values.imageUrls}\n          onChange={(urls) => setValues((v) => ({ ...v, imageUrls: urls }))}\n          disabled={isPending}\n        />\n      </fieldset>\n\n      {/* Publishing */}\n      <fieldset className=\"space-y-4 border border-[var(--p-tan)] bg-[var(--p-white)] p-6\">\n        <legend className=\"px-2 text-xs font-semibold uppercase tracking-wider text-[var(--p-toffee)]\">\n          Publishing\n        </legend>\n        <label className=\"flex cursor-pointer items-center gap-3\">\n          <input\n            type=\"checkbox\"\n            checked={values.published}\n            onChange={(e) =>\n              setValues((v) => ({ ...v, published: e.target.checked }))\n            }\n            className=\"size-4 accent-[var(--p-deep-walnut)]\"\n          />\n          <span className=\"text-sm text-[var(--p-dark-walnut)]\">\n            Published — visible on the public site\n          </span>\n        </label>\n      </fieldset>\n\n      {/* Submit */}\n      <div className=\"flex gap-3\">\n        <button type=\"submit\" className={btnPrimary} disabled={isPending}>\n          {mode === \"create\" ? \"Create project\" : \"Save changes\"}\n        </button>\n        <button\n          type=\"button\"\n          className={btnOutline}\n          onClick={() => router.push(\"/cms/projects\")}\n        >\n          Cancel\n        </button>\n      </div>\n    </form>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1065, "column": 0}, "map": {"version":3,"sources":["file:///Users/arthur/Documents/Projects/sd-services/src/app/cms/projects/%5Bid%5D/edit/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { useState } from \"react\";\nimport { useParams, useRouter } from \"next/navigation\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { toast } from \"sonner\";\n\nimport { client } from \"@/utils/orpc\";\n\nimport {\n  AlertDialogBackdrop,\n  AlertDialogClose,\n  AlertDialogDescription,\n  AlertDialogPopup,\n  AlertDialogPortal,\n  AlertDialogRoot,\n  AlertDialogTitle,\n  AlertDialogViewport,\n} from \"@/components/ui/alert-dialog\";\n\nimport { ProjectForm } from \"../../project-form\";\n\nconst btnOutline =\n  \"inline-flex h-9 items-center justify-center border-2 border-[var(--p-tan)] bg-transparent px-5 text-xs font-semibold text-[var(--p-coffee-bean)] outline-none transition-opacity hover:opacity-80 focus-visible:ring-2 focus-visible:ring-[var(--p-toffee)] focus-visible:ring-offset-2\";\nconst btnDanger =\n  \"inline-flex h-9 items-center justify-center border-2 border-red-700 bg-red-700 px-5 text-xs font-semibold text-white outline-none transition-opacity hover:opacity-90 focus-visible:ring-2 focus-visible:ring-red-700 focus-visible:ring-offset-2\";\n\nfunction mapProjectToForm(project: {\n  slug: string;\n  title: string;\n  description: string;\n  featuredImageUrl: string | null;\n  published: boolean;\n  images: { url: string; sortOrder: number }[];\n}) {\n  const imageUrls = [...(project.images ?? [])]\n    .sort((a, b) => a.sortOrder - b.sortOrder)\n    .map((i) => i.url);\n  return {\n    slug: project.slug,\n    title: project.title,\n    description: project.description,\n    featuredImageUrl: project.featuredImageUrl ?? \"\",\n    published: project.published,\n    imageUrls,\n  };\n}\n\nexport default function EditProjectPage() {\n  const params = useParams();\n  const router = useRouter();\n  const id = params.id as string;\n\n  const { data: project, isPending } = useQuery({\n    queryKey: [\"project\", id],\n    queryFn: () => client.project.getById({ id }),\n    enabled: !!id,\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: () => client.project.delete({ id }),\n    onSuccess: () => {\n      toast.success(\"Project deleted\");\n      router.push(\"/cms/projects\");\n    },\n    onError: (e: Error) => toast.error(e.message ?? \"Failed to delete\"),\n  });\n\n  const [deleteOpen, setDeleteOpen] = useState(false);\n  function confirmDelete() {\n    setDeleteOpen(false);\n    deleteMutation.mutate();\n  }\n\n  if (isPending || !project) {\n    return (\n      <div className=\"max-w-2xl space-y-6\">\n        <div className=\"h-7 w-40 rounded bg-[var(--p-warm-white)]\" />\n        <div className=\"h-64 w-full rounded bg-[var(--p-warm-white)]\" />\n      </div>\n    );\n  }\n\n  return (\n    <div>\n      <div className=\"mb-8 flex items-start justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-balance text-[var(--p-deep-walnut)]\">\n            Edit project\n          </h1>\n          <div className=\"mt-2 h-px w-10 bg-[var(--p-tan)]\" aria-hidden />\n        </div>\n        <div className=\"flex shrink-0 gap-2\">\n          <Link\n            href={`/projects/${project.slug}`}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className={btnOutline}\n          >\n            View on site\n          </Link>\n          <button\n            type=\"button\"\n            className={btnDanger}\n            onClick={() => setDeleteOpen(true)}\n            aria-label=\"Delete project\"\n          >\n            Delete\n          </button>\n        </div>\n      </div>\n\n      <ProjectForm\n        mode=\"edit\"\n        id={id}\n        initialData={mapProjectToForm(project)}\n      />\n\n      <AlertDialogRoot open={deleteOpen} onOpenChange={setDeleteOpen}>\n        <AlertDialogPortal>\n          <AlertDialogBackdrop />\n          <AlertDialogViewport>\n            <AlertDialogPopup>\n              <AlertDialogTitle>Delete project?</AlertDialogTitle>\n              <AlertDialogDescription>\n                This cannot be undone. The project and its images will be removed.\n              </AlertDialogDescription>\n              <div className=\"flex justify-end gap-2\">\n                <AlertDialogClose variant=\"outline\">Cancel</AlertDialogClose>\n                <button type=\"button\" className={btnDanger} onClick={confirmDelete}>\n                  Delete\n                </button>\n              </div>\n            </AlertDialogPopup>\n          </AlertDialogViewport>\n        </AlertDialogPortal>\n      </AlertDialogRoot>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAEA;AAWA;AArBA;;;;;;;;;;AAuBA,MAAM,aACJ;AACF,MAAM,YACJ;AAEF,SAAS,iBAAiB,OAOzB;IACC,MAAM,YAAY;WAAK,QAAQ,MAAM,IAAI,EAAE;KAAE,CAC1C,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,SAAS,GAAG,EAAE,SAAS,EACxC,GAAG,CAAC,CAAC,IAAM,EAAE,GAAG;IACnB,OAAO;QACL,MAAM,QAAQ,IAAI;QAClB,OAAO,QAAQ,KAAK;QACpB,aAAa,QAAQ,WAAW;QAChC,kBAAkB,QAAQ,gBAAgB,IAAI;QAC9C,WAAW,QAAQ,SAAS;QAC5B;IACF;AACF;AAEe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,KAAK,OAAO,EAAE;IAEpB,MAAM,EAAE,MAAM,OAAO,EAAE,SAAS,EAAE,GAAG,IAAA,uLAAQ,EAAC;QAC5C,UAAU;YAAC;YAAW;SAAG;QACzB,SAAS,IAAM,8HAAM,CAAC,OAAO,CAAC,OAAO,CAAC;gBAAE;YAAG;QAC3C,SAAS,CAAC,CAAC;IACb;IAEA,MAAM,iBAAiB,IAAA,6LAAW,EAAC;QACjC,YAAY,IAAM,8HAAM,CAAC,OAAO,CAAC,MAAM,CAAC;gBAAE;YAAG;QAC7C,WAAW;YACT,iJAAK,CAAC,OAAO,CAAC;YACd,OAAO,IAAI,CAAC;QACd;QACA,SAAS,CAAC,IAAa,iJAAK,CAAC,KAAK,CAAC,EAAE,OAAO,IAAI;IAClD;IAEA,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAC7C,SAAS;QACP,cAAc;QACd,eAAe,MAAM;IACvB;IAEA,IAAI,aAAa,CAAC,SAAS;QACzB,qBACE,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAI,WAAU;;;;;;8BACf,8OAAC;oBAAI,WAAU;;;;;;;;;;;;IAGrB;IAEA,qBACE,8OAAC;;0BACC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;0CACC,8OAAC;gCAAG,WAAU;0CAA8D;;;;;;0CAG5E,8OAAC;gCAAI,WAAU;gCAAmC,aAAW;;;;;;;;;;;;kCAE/D,8OAAC;wBAAI,WAAU;;0CACb,8OAAC,uKAAI;gCACH,MAAM,CAAC,UAAU,EAAE,QAAQ,IAAI,EAAE;gCACjC,QAAO;gCACP,KAAI;gCACJ,WAAW;0CACZ;;;;;;0CAGD,8OAAC;gCACC,MAAK;gCACL,WAAW;gCACX,SAAS,IAAM,cAAc;gCAC7B,cAAW;0CACZ;;;;;;;;;;;;;;;;;;0BAML,8OAAC,gKAAW;gBACV,MAAK;gBACL,IAAI;gBACJ,aAAa,iBAAiB;;;;;;0BAGhC,8OAAC,8JAAe;gBAAC,MAAM;gBAAY,cAAc;0BAC/C,cAAA,8OAAC,gKAAiB;;sCAChB,8OAAC,kKAAmB;;;;;sCACpB,8OAAC,kKAAmB;sCAClB,cAAA,8OAAC,+JAAgB;;kDACf,8OAAC,+JAAgB;kDAAC;;;;;;kDAClB,8OAAC,qKAAsB;kDAAC;;;;;;kDAGxB,8OAAC;wCAAI,WAAU;;0DACb,8OAAC,+JAAgB;gDAAC,SAAQ;0DAAU;;;;;;0DACpC,8OAAC;gDAAO,MAAK;gDAAS,WAAW;gDAAW,SAAS;0DAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUpF"}}]
}