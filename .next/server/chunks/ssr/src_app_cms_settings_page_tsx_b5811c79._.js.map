{"version":3,"sources":["../../../../src/app/cms/settings/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { toast } from \"sonner\";\n\nimport { ImageUploader } from \"@/components/image-uploader\";\nimport { proxyImageUrlIfNeeded } from \"@/lib/image-url\";\nimport { cn } from \"@/lib/utils\";\nimport { client, queryClient } from \"@/utils/orpc\";\n\nconst HERO_IMAGE_KEY = \"hero_image_url\";\nconst CONTACT_EMAIL_KEY = \"contact_email\";\nconst CONTACT_PHONE_KEY = \"contact_phone\";\n\nconst labelClass = \"block text-xs font-semibold uppercase tracking-wider text-[var(--p-deep-walnut)]\";\nconst inputClass =\n  \"flex h-9 w-full border border-[var(--p-tan)] bg-[var(--p-white)] px-3 text-sm text-[var(--p-dark-walnut)] outline-none placeholder:text-[var(--p-coffee-bean)]/40 focus-visible:ring-1 focus-visible:ring-[var(--p-toffee)]\";\nconst btnPrimary =\n  \"inline-flex h-9 items-center justify-center border-2 border-[var(--p-deep-walnut)] bg-[var(--p-deep-walnut)] px-5 text-xs font-semibold text-[var(--p-white)] outline-none transition-opacity hover:opacity-90 focus-visible:ring-2 focus-visible:ring-[var(--p-deep-walnut)] focus-visible:ring-offset-2 disabled:opacity-50\";\nconst btnOutline =\n  \"inline-flex h-9 items-center justify-center border-2 border-[var(--p-tan)] bg-transparent px-5 text-xs font-semibold text-[var(--p-coffee-bean)] outline-none transition-opacity hover:opacity-80 focus-visible:ring-2 focus-visible:ring-[var(--p-toffee)] focus-visible:ring-offset-2\";\n\nexport default function SettingsPage() {\n  const heroQuery = useQuery({\n    queryKey: [\"setting\", HERO_IMAGE_KEY],\n    queryFn: () => client.setting.get({ key: HERO_IMAGE_KEY }),\n  });\n\n  const emailQuery = useQuery({\n    queryKey: [\"setting\", CONTACT_EMAIL_KEY],\n    queryFn: () => client.setting.get({ key: CONTACT_EMAIL_KEY }),\n  });\n\n  const phoneQuery = useQuery({\n    queryKey: [\"setting\", CONTACT_PHONE_KEY],\n    queryFn: () => client.setting.get({ key: CONTACT_PHONE_KEY }),\n  });\n\n  const projectsQuery = useQuery({\n    queryKey: [\"projects-admin\"],\n    queryFn: () => client.project.listAdmin(),\n  });\n\n  const [localUrl, setLocalUrl] = useState<string | null>(null);\n  const currentUrl = localUrl ?? heroQuery.data ?? \"\";\n\n  const [localEmail, setLocalEmail] = useState<string | null>(null);\n  const currentEmail = localEmail ?? emailQuery.data ?? \"\";\n\n  const [localPhone, setLocalPhone] = useState<string | null>(null);\n  const currentPhone = localPhone ?? phoneQuery.data ?? \"\";\n\n  const saveMutation = useMutation({\n    mutationFn: (value: string) =>\n      client.setting.upsert({ key: HERO_IMAGE_KEY, value }),\n    onSuccess: () => {\n      toast.success(\"Hero image updated\");\n      queryClient.invalidateQueries({ queryKey: [\"setting\", HERO_IMAGE_KEY] });\n    },\n    onError: (e: Error) => toast.error(e.message ?? \"Failed to save\"),\n  });\n\n  const saveContactMutation = useMutation({\n    mutationFn: async () => {\n      await Promise.all([\n        client.setting.upsert({ key: CONTACT_EMAIL_KEY, value: currentEmail }),\n        client.setting.upsert({ key: CONTACT_PHONE_KEY, value: currentPhone }),\n      ]);\n    },\n    onSuccess: () => {\n      toast.success(\"Contact details updated\");\n      queryClient.invalidateQueries({ queryKey: [\"setting\", CONTACT_EMAIL_KEY] });\n      queryClient.invalidateQueries({ queryKey: [\"setting\", CONTACT_PHONE_KEY] });\n    },\n    onError: (e: Error) => toast.error(e.message ?? \"Failed to save\"),\n  });\n\n  function handleSave() {\n    saveMutation.mutate(currentUrl);\n  }\n\n  function handleClear() {\n    setLocalUrl(\"\");\n  }\n\n  const projects = projectsQuery.data ?? [];\n  const projectsWithImages = projects.filter(\n    (p): p is typeof p & { featuredImageUrl: string } =>\n      typeof (p as { featuredImageUrl?: string }).featuredImageUrl === \"string\" &&\n      (p as { featuredImageUrl?: string }).featuredImageUrl !== \"\",\n  );\n\n  return (\n    <div className=\"max-w-2xl space-y-8\">\n      <div>\n        <h1 className=\"text-2xl font-bold text-balance text-[var(--p-deep-walnut)]\">\n          Site settings\n        </h1>\n        <div className=\"mt-2 h-px w-10 bg-[var(--p-tan)]\" aria-hidden />\n        <p className=\"mt-3 text-sm text-pretty text-[var(--p-coffee-bean)]\">\n          Configure the landing page hero image and other site-wide settings.\n        </p>\n      </div>\n\n      <fieldset className=\"space-y-5 border border-[var(--p-tan)] bg-[var(--p-white)] p-6\">\n        <legend className=\"px-2 text-xs font-semibold uppercase tracking-wider text-[var(--p-toffee)]\">\n          Hero image\n        </legend>\n\n        <ImageUploader\n          multiple={false}\n          value={currentUrl ? [currentUrl] : []}\n          onChange={(urls) => setLocalUrl(urls[0] ?? \"\")}\n        />\n\n        <div className=\"space-y-1.5\">\n          <label htmlFor=\"hero-url\" className={labelClass}>Or paste URL</label>\n          <input\n            id=\"hero-url\"\n            className={inputClass}\n            value={currentUrl}\n            onChange={(e) => setLocalUrl(e.target.value)}\n            placeholder=\"https://...\"\n          />\n        </div>\n\n        {projectsWithImages.length > 0 && (\n          <div className=\"space-y-2\">\n            <label className={labelClass}>Or select from a project</label>\n            <div className=\"grid grid-cols-3 gap-2 sm:grid-cols-4\">\n              {projectsWithImages.map((p) => (\n                <button\n                  key={p.id}\n                  type=\"button\"\n                  onClick={() => setLocalUrl(p.featuredImageUrl)}\n                  className={cn(\n                    \"group relative aspect-video overflow-hidden border border-[var(--p-tan)] outline-none transition-all\",\n                    currentUrl === p.featuredImageUrl\n                      ? \"ring-2 ring-[var(--p-deep-walnut)] ring-offset-2\"\n                      : \"hover:ring-1 hover:ring-[var(--p-toffee)]\",\n                  )}\n                >\n                  {/* eslint-disable-next-line @next/next/no-img-element */}\n                  <img\n                    src={proxyImageUrlIfNeeded(p.featuredImageUrl)}\n                    alt={p.title}\n                    className=\"size-full object-cover\"\n                  />\n                  <span className=\"absolute inset-x-0 bottom-0 bg-[var(--p-deep-walnut)]/80 px-1.5 py-0.5 text-[10px] text-[var(--p-white)] truncate\">\n                    {p.title}\n                  </span>\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        <div className=\"flex gap-3 pt-1\">\n          <button\n            type=\"button\"\n            className={btnPrimary}\n            onClick={handleSave}\n            disabled={saveMutation.isPending}\n          >\n            {saveMutation.isPending ? \"Saving…\" : \"Save\"}\n          </button>\n          <button type=\"button\" className={btnOutline} onClick={handleClear}>\n            Clear\n          </button>\n        </div>\n      </fieldset>\n\n      {/* ── Contact details ── */}\n      <fieldset className=\"space-y-5 border border-[var(--p-tan)] bg-[var(--p-white)] p-6\">\n        <legend className=\"px-2 text-xs font-semibold uppercase tracking-wider text-[var(--p-toffee)]\">\n          Contact details\n        </legend>\n        <p className=\"text-xs text-pretty text-[var(--p-coffee-bean)]/70\">\n          Shown in the landing page contact section. These replace the\n          placeholder values visible to visitors.\n        </p>\n\n        <div className=\"space-y-1.5\">\n          <label htmlFor=\"contact-email\" className={labelClass}>\n            Contact email\n          </label>\n          <input\n            id=\"contact-email\"\n            type=\"email\"\n            className={inputClass}\n            value={currentEmail}\n            onChange={(e) => setLocalEmail(e.target.value)}\n            placeholder=\"hello@yourcompany.com\"\n          />\n          <p className=\"text-xs text-[var(--p-coffee-bean)]/50\">\n            Used as the mailto: address for the &ldquo;Request a quote&rdquo; button.\n          </p>\n        </div>\n\n        <div className=\"space-y-1.5\">\n          <label htmlFor=\"contact-phone\" className={labelClass}>\n            Phone number\n          </label>\n          <input\n            id=\"contact-phone\"\n            type=\"tel\"\n            className={inputClass}\n            value={currentPhone}\n            onChange={(e) => setLocalPhone(e.target.value)}\n            placeholder=\"+1 (000) 000-0000\"\n          />\n          <p className=\"text-xs text-[var(--p-coffee-bean)]/50\">\n            Displayed as a clickable tel: link. Use E.164 format for the href,\n            e.g.{\" \"}\n            <code className=\"font-mono\">+17045550199</code>.\n          </p>\n        </div>\n\n        <div className=\"flex gap-3 pt-1\">\n          <button\n            type=\"button\"\n            className={btnPrimary}\n            onClick={() => saveContactMutation.mutate()}\n            disabled={saveContactMutation.isPending}\n          >\n            {saveContactMutation.isPending ? \"Saving…\" : \"Save\"}\n          </button>\n        </div>\n      </fieldset>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}